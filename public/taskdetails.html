<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Details Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/buttons/2.3.6/css/buttons.bootstrap5.min.css" rel="stylesheet">
    <style>
        html, body { height: 100%; overflow: hidden; background: #f8f9fa; }
        #mainContent { height: 100vh; overflow: hidden; }
        .datatable-wrapper { background: #fff; padding: 15px; border-radius: 6px; height: calc(100vh - 110px); display: flex; flex-direction: column; }
        .dataTables_scrollBody { overflow-y: auto !important; overflow-x: auto !important; }
        table.dataTable thead th, table.dataTable tbody td { white-space: nowrap; font-size: 12px; }
        .dt-buttons { float: right; }
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 500; }
        .status-upcoming { background-color: #fff3cd; color: #856404; }
        .status-ongoing { background-color: #d1ecf1; color: #0c5460; }
        .status-completed { background-color: #d4edda; color: #155724; }
        .sidebar-header { position: sticky; top: 0; background: #f8f9fa; z-index: 1; padding: 1rem; margin: -1rem -1rem 1rem -1rem; border-bottom: 1px solid #dee2e6; display: flex; justify-content: space-between; align-items: center; }
        .sidebar-header h5 { margin: 0; font-size: 1.1rem; font-weight: 600; }
        .sidebar-header .btn { padding: 0.4rem 0.6rem; font-size: 1rem; }
        .clear-filters-btn { position: sticky; bottom: 0; background: #f8f9fa; padding: 1rem; margin: 1rem -1rem -1rem -1rem; border-top: 1px solid #dee2e6; z-index: 1; }
    </style>
</head>

<body>
    <div class="d-flex">
        <div class="bg-light border-end" id="sidebar" style="width:300px;height:100vh;position:fixed;left:0;top:0;transform:translateX(-100%);transition:.3s;z-index:1000;overflow-y:auto;">
            <div class="sidebar-header">
                <h5>Filters</h5>
                <button class="btn btn-sm btn-outline-secondary" id="closeSidebar"><i class="bi bi-x-lg"></i></button>
            </div>
            <div style="padding: 0 1rem;">
                <div class="row g-3">
                    <div class="col-12"><label class="form-label">Work Request ID</label><input type="text" class="form-control" id="filterWorkRequestID"></div>
                    <div class="col-12"><label class="form-label">Project Name</label><input type="text" class="form-control" id="filterProjectName"></div>
                    <div class="col-12"><label class="form-label">Project Type</label><input type="text" class="form-control" id="filterProjectType"></div>
                    <div class="col-12"><label class="form-label">Requester Division</label><input type="text" class="form-control" id="filterRequesterDivision"></div>
                    <div class="col-12"><label class="form-label">Requester Name</label><input type="text" class="form-control" id="filterRequesterName"></div>
                    <div class="col-12"><label class="form-label">Manager Division</label><input type="text" class="form-control" id="filterManagerDivision"></div>
                    <div class="col-12"><label class="form-label">Manager Name</label><input type="text" class="form-control" id="filterManagerName"></div>
                    <div class="col-12"><label class="form-label">Task ID</label><input type="text" class="form-control" id="filterTaskID"></div>
                    <div class="col-12"><label class="form-label">Task Name</label><input type="text" class="form-control" id="filterTaskName"></div>
                    <div class="col-12"><label class="form-label">Task Type</label><input type="text" class="form-control" id="filterTaskType"></div>
                    <div class="col-12"><label class="form-label">Creative User</label><input type="text" class="form-control" id="filterCreativeUser"></div>
                    <div class="col-12"><label class="form-label">Task Count</label><input type="number" class="form-control" id="filterTaskCount"></div>
                    <div class="col-12"><label class="form-label">No of Work Pages</label><input type="number" class="form-control" id="filterNoOfWorkPages"></div>
                    <div class="col-12"><label class="form-label">Task Status</label><select class="form-control" id="filterTaskStatus"><option value="">All</option><option value="upcoming">Upcoming</option><option value="ongoing">Ongoing</option><option value="completed">Completed</option></select></div>
                </div>
            </div>
            <div class="clear-filters-btn">
                <button class="btn btn-outline-secondary w-100" id="clearFilters"><i class="bi bi-arrow-counterclockwise me-2"></i>Clear Filters</button>
            </div>
        </div>
        <div class="flex-grow-1" id="mainContent">
            <div class="container-fluid pt-3">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3>Task Details Admin Panel</h3>
                    <div>
                        <a href="/digilabs/dmap/api/datatable/admin/projectsdetails" class="btn btn-outline-primary me-2">Projects</a>
                        <button class="btn btn-outline-primary" id="toggleSidebar">Filters</button>
                    </div>
                </div>
                <div class="datatable-wrapper">
                    <table id="taskDetailsTable" class="table table-bordered table-striped w-100">
                        <thead><tr><th>Work Request ID</th><th>Project Name</th><th>Project Type</th><th>Requester Division</th><th>Requester Name</th><th>Manager Division</th><th>Manager Name</th><th>Task ID</th><th>Task Name</th><th>Task Type</th><th>Creative User</th><th>Task Count</th><th>No of Work Pages</th><th>Task Start Date</th><th>Task End Date</th><th>Task Status</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.3.6/js/buttons.html5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        $(document).ready(function() {
            var table = $('#taskDetailsTable').DataTable({
                ajax: { url: '/digilabs/dmap/api/datatable/admin/taskdetails/data', dataSrc: 'data' },
                columns: [
                    { data: 'work_request_id' },
                    { data: 'project_name' },
                    { data: 'project_type' },
                    { data: 'requester_division' },
                    { data: 'requester_name' },
                    { data: 'manager_division' },
                    { data: 'manager_name' },
                    { data: 'task_id' },
                    { data: 'task_name' },
                    { data: 'task_type' },
                    { data: 'creative_user' },
                    { data: 'task_count' },
                    { data: 'no_of_work_pages' },
                    { data: 'task_start_date' },
                    { data: 'task_end_date' },
                    { data: 'task_status', render: function(data) {
                        var cls = '';
                        if (data == 'upcoming') cls = 'status-upcoming';
                        else if (data == 'ongoing') cls = 'status-ongoing';
                        else if (data == 'completed') cls = 'status-completed';
                        return '<span class="status-badge ' + cls + '">' + (data || '') + '</span>';
                    }}
                ],
                pageLength: 20, lengthMenu: [[20, 50, 100, -1], [20, 50, 100, 'All']], dom: 'lBfrtip',
                scrollX: true, scrollY: '55vh', scrollCollapse: true,
                buttons: [
                    { extend: 'excel', text: '<i class="bi bi-file-earmark-excel"></i>', className: 'btn btn-success btn-sm', titleAttr: 'Export to Excel', filename: function() { return 'task_details_' + new Date().toISOString().slice(0, 10); } },
                    { extend: 'csv', text: '<i class="bi bi-filetype-csv"></i>', className: 'btn btn-secondary btn-sm', titleAttr: 'Export to CSV', filename: function() { return 'task_details_' + new Date().toISOString().slice(0, 10); } }
                ],
                initComplete: function() {
                    var api = this.api();
                    var filterMap = { 0: '#filterWorkRequestID', 1: '#filterProjectName', 2: '#filterProjectType', 3: '#filterRequesterDivision', 4: '#filterRequesterName', 5: '#filterManagerDivision', 6: '#filterManagerName', 7: '#filterTaskID', 8: '#filterTaskName', 9: '#filterTaskType', 10: '#filterCreativeUser', 11: '#filterTaskCount', 12: '#filterNoOfWorkPages', 15: '#filterTaskStatus' };
                    api.columns().every(function(i) {
                        $(filterMap[i]).on('keyup change', function() { col.search(this.value).draw(); });
                    });
                }
            });
            $('#toggleSidebar').click(function() { $('#sidebar').css('transform', 'translateX(0)'); $('#mainContent').css('margin-left', '300px'); });
            $('#closeSidebar').click(function() { $('#sidebar').css('transform', 'translateX(-100%)'); $('#mainContent').css('margin-left', '0'); });
            $('#clearFilters').click(function() { $('#sidebar input').val(''); $('#sidebar select').val(''); table.search('').columns().search('').draw(); table.ajax.url('/digilabs/dmap/api/datatable/admin/taskdetails/data').load(); });
        });
    </script>
</body>
</html>
