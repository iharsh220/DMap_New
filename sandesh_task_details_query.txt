SELECT
    wr.id AS work_request_id,
    COALESCE(wr.project_name, 'N/A') AS project_name,
    COALESCE(rt.request_type, 'N/A') AS project_type,
    COALESCE(rdiv.title, 'N/A') AS requester_division,
    COALESCE(ru.name, 'N/A') AS requester_name,
    COALESCE(mdiv.title, 'N/A') AS manager_division,
    COALESCE(GROUP_CONCAT(DISTINCT mu.name ORDER BY mu.name SEPARATOR ', '), 'N/A') AS manager_name,
    t.id AS task_id,
    t.task_name,
    tt.task_type,
    COALESCE(au.name, 'N/A') AS creative_user,
    1 AS task_count,
    t.task_count AS no_of_work_pages,
    COALESCE(t.start_date, 'N/A') AS task_start_date,
    COALESCE(t.end_date, 'N/A') AS task_end_date,
    CASE
        WHEN t.start_date IS NULL AND t.end_date IS NULL THEN 'upcoming'
        WHEN t.start_date IS NOT NULL AND t.end_date IS NOT NULL THEN 'completed'
        ELSE 'ongoing'
    END AS task_status
FROM tasks t
LEFT JOIN work_requests wr ON t.work_request_id = wr.id
LEFT JOIN request_type rt ON wr.request_type_id = rt.id
LEFT JOIN task_type tt ON t.task_type_id = tt.id
LEFT JOIN users ru ON wr.user_id = ru.id
LEFT JOIN user_divisions rud ON ru.id = rud.user_id
LEFT JOIN division rdiv ON rud.division_id = rdiv.id
LEFT JOIN work_request_managers wrm ON wr.id = wrm.work_request_id
LEFT JOIN users mu ON wrm.manager_id = mu.id
LEFT JOIN request_division_reference rdr ON rt.id = rdr.request_id
LEFT JOIN division mdiv ON rdr.division_id = mdiv.id
LEFT JOIN task_assignments ta ON t.id = ta.task_id
LEFT JOIN users au ON ta.user_id = au.id
GROUP BY
    wr.id,
    wr.project_name,
    rt.request_type,
    rdiv.title,
    ru.name,
    mdiv.title,
    t.id,
    t.task_name,
    tt.task_type,
    au.name
ORDER BY t.id DESC;
